<template>
  <div class="container relative flex-col items-start justify-start">
    <svg
      width="230"
      height="2137"
      viewBox="0 0 230 2137"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
      class="absolute top-10 left-30 hidden lg:block"
    >
      <path
        id="scrollPath"
        d="M49 23.5C49 23.5 46.6691 191.891 55.5 310C64.2073 426.454 152.743 330.997 169.5 471.5C182.5 580.5 37.1647 549.524 21.6247 657.634C-0.0141209 808.172 202.172 795.782 172.381 937.704C154.068 1024.95 53.5612 1018.03 30.8047 1098.74C-14.4145 1259.12 242.742 1319.13 226.237 1509.85C213.699 1654.71 70.3778 1644.75 77.1127 1791.92C83.0872 1922.47 185.61 1832.13 186.865 1963.46V2118"
        stroke="#7FC4F8"
        stroke-width="5"
      />
      <circle cx="159.5" cy="970.5" r="19" fill="#FBFBFB" stroke="#9CD1F9" />
      <circle cx="186.5" cy="1376.5" r="19" fill="#FBFBFB" stroke="#9CD1F9" />
      <circle cx="79.5" cy="1747.5" r="19" fill="#FBFBFB" stroke="#9CD1F9" />
      <circle cx="186.5" cy="2117.5" r="19" fill="#FBFBFB" stroke="#9CD1F9" />
      <path
        d="M148.5 978.5H169.5M150.833 978.5V962.167L160.167 957.5V978.5M167.167 978.5V966.833L160.167 962.167M155.5 964.5V964.512M155.5 968V968.012M155.5 971.5V971.512M155.5 975V975.012"
        stroke="#5ED296"
        stroke-width="2.66667"
        stroke-linecap="round"
        stroke-linejoin="round"
      />
      <path
        d="M174.083 1367.25V1386.75H197.917V1367.25H174.083ZM195.75 1369.42V1379.17H176.25V1369.42H195.75ZM184.917 1381.33V1384.58H181.667V1381.33H184.917ZM176.25 1381.33H179.5V1384.58H176.25V1381.33ZM187.083 1384.58V1381.33H190.333V1384.58H187.083ZM192.5 1384.58V1381.33H195.75V1384.58H192.5Z"
        fill="#5ED296"
      />
      <path
        d="M88.7812 1738.22H70.2188C69.7712 1738.22 69.342 1738.4 69.0255 1738.71C68.709 1739.03 68.5312 1739.46 68.5312 1739.91V1755.09C68.5312 1755.54 68.709 1755.97 69.0255 1756.29C69.342 1756.6 69.7712 1756.78 70.2188 1756.78H71.631C71.7907 1756.78 71.9471 1756.74 72.0821 1756.65C72.2171 1756.57 72.325 1756.44 72.3935 1756.3C72.8038 1755.43 73.4516 1754.7 74.2615 1754.19C75.0715 1753.68 76.0103 1753.4 76.9688 1753.4C77.9272 1753.4 78.866 1753.68 79.676 1754.19C80.4859 1754.7 81.1337 1755.43 81.544 1756.3C81.6125 1756.44 81.7204 1756.57 81.8554 1756.65C81.9904 1756.74 82.1468 1756.78 82.3065 1756.78H88.7812C89.2288 1756.78 89.658 1756.6 89.9745 1756.29C90.291 1755.97 90.4688 1755.54 90.4688 1755.09V1739.91C90.4688 1739.46 90.291 1739.03 89.9745 1738.71C89.658 1738.4 89.2288 1738.22 88.7812 1738.22ZM74.4375 1749.19C74.4375 1748.69 74.586 1748.2 74.8641 1747.78C75.1422 1747.36 75.5376 1747.04 76.0001 1746.85C76.4626 1746.66 76.9716 1746.61 77.4626 1746.7C77.9536 1746.8 78.4046 1747.04 78.7586 1747.4C79.1126 1747.75 79.3537 1748.2 79.4514 1748.69C79.549 1749.18 79.4989 1749.69 79.3073 1750.16C79.1157 1750.62 78.7913 1751.01 78.375 1751.29C77.9588 1751.57 77.4694 1751.72 76.9688 1751.72C76.2974 1751.72 75.6536 1751.45 75.1789 1750.98C74.7042 1750.5 74.4375 1749.86 74.4375 1749.19ZM88.7812 1755.09H82.8149C82.1102 1753.88 81.0481 1752.92 79.7742 1752.33C80.4129 1751.77 80.8637 1751.02 81.0668 1750.19C81.2699 1749.36 81.2157 1748.48 80.9115 1747.68C80.6072 1746.88 80.0672 1746.2 79.3631 1745.71C78.659 1745.23 77.824 1744.97 76.9688 1744.97C76.1135 1744.97 75.2785 1745.23 74.5744 1745.71C73.8703 1746.2 73.3303 1746.88 73.026 1747.68C72.7218 1748.48 72.6676 1749.36 72.8707 1750.19C73.0738 1751.02 73.5246 1751.77 74.1633 1752.33C72.8894 1752.92 71.8273 1753.88 71.1226 1755.09H70.2188V1739.91H88.7812V1755.09ZM71.9062 1744.12V1742.44C71.9062 1742.21 71.9951 1742 72.1534 1741.84C72.3116 1741.68 72.5262 1741.59 72.75 1741.59H86.25C86.4738 1741.59 86.6884 1741.68 86.8466 1741.84C87.0049 1742 87.0938 1742.21 87.0938 1742.44V1752.56C87.0938 1752.79 87.0049 1753 86.8466 1753.16C86.6884 1753.32 86.4738 1753.41 86.25 1753.41H84.5625C84.3387 1753.41 84.1241 1753.32 83.9659 1753.16C83.8076 1753 83.7188 1752.79 83.7188 1752.56C83.7188 1752.34 83.8076 1752.12 83.9659 1751.97C84.1241 1751.81 84.3387 1751.72 84.5625 1751.72H85.4062V1743.28H73.5938V1744.12C73.5938 1744.35 73.5049 1744.56 73.3466 1744.72C73.1884 1744.88 72.9738 1744.97 72.75 1744.97C72.5262 1744.97 72.3116 1744.88 72.1534 1744.72C71.9951 1744.56 71.9062 1744.35 71.9062 1744.12Z"
        fill="#5ED296"
      />
      <path
        d="M193.5 2107.17C192.525 2107.17 191.333 2108.25 191.333 2109.33H182.667C182.667 2108.25 181.475 2107.17 180.5 2107.17H176.167V2116.92C176.167 2118 177.25 2119.08 178.333 2119.08H180.717C181.15 2121.25 182.558 2123.09 185.917 2123.42V2125.67C182.667 2126.17 182.667 2128.83 182.667 2128.83H191.333C191.333 2128.83 191.333 2126.17 188.083 2125.67V2123.42C191.442 2123.09 192.85 2121.25 193.283 2119.08H195.667C196.75 2119.08 197.833 2118 197.833 2116.92V2107.17H193.5ZM180.5 2116.92H178.333V2109.33H180.5V2116.92ZM191.333 2117.46C191.333 2119.55 190.705 2121.25 187 2121.25C183.306 2121.25 182.667 2119.55 182.667 2117.46V2111.5H191.333V2117.46ZM195.667 2116.92H193.5V2109.33H195.667V2116.92Z"
        fill="#5ED296"
      />
      <circle cx="48.5" cy="19.5" r="19" fill="#FBFBFB" stroke="#9CD1F9" />
      <path
        d="M34.6667 19L48 7L61.3334 19H57.3334V29.6667H38.6667V19H34.6667ZM48 27L48.96 26.12C52.4 23 54.6667 20.9467 54.6667 18.4267C54.6667 16.3733 53.0534 14.76 51 14.76C49.84 14.76 48.7334 15.3067 48 16.16C47.6289 15.726 47.1691 15.3766 46.6517 15.1351C46.1342 14.8936 45.571 14.7657 45 14.76C42.9467 14.76 41.3334 16.3733 41.3334 18.4267C41.3334 20.9467 43.6 23 47.04 26.12L48 27Z"
        fill="#5ED296"
      />
      <circle cx="91.5" cy="370.5" r="19" fill="#FBFBFB" stroke="#9CD1F9" />
      <path
        d="M102.969 360.25C102.969 359.927 102.84 359.617 102.612 359.388C102.383 359.16 102.073 359.031 101.75 359.031C97.202 359.031 92.6094 363.961 89.9789 367.359C89.0181 367.111 88.0133 367.086 87.0415 367.287C86.0696 367.487 85.1565 367.907 84.3722 368.515C83.5879 369.123 82.9531 369.902 82.5166 370.794C82.0801 371.685 81.8534 372.664 81.8539 373.656C81.8539 374.875 81.5391 375.963 80.9165 376.882C80.6551 377.28 80.3302 377.633 79.9547 377.927C79.7358 378.069 79.5689 378.278 79.4789 378.523C79.389 378.768 79.381 379.036 79.456 379.286C79.5326 379.539 79.6889 379.76 79.9016 379.917C80.1143 380.074 80.3719 380.158 80.6362 380.156H88.3549C89.3463 380.155 90.3242 379.927 91.2139 379.49C92.1036 379.053 92.8816 378.418 93.4882 377.634C94.0948 376.849 94.514 375.937 94.7137 374.966C94.9135 373.995 94.8885 372.991 94.6406 372.031C98.042 369.396 102.969 364.8 102.969 360.25ZM100.29 361.711C99.8833 363.024 98.954 364.503 97.5555 366.07C97.2508 366.414 96.9299 366.75 96.6059 367.074C96.1118 366.454 95.5497 365.892 94.9301 365.397C95.2541 365.073 95.5892 364.755 95.9335 364.448C97.4996 363.048 98.9784 362.122 100.29 361.711ZM88.3509 377.719H83.2656C83.9575 376.478 84.3126 375.077 84.2955 373.656C84.2955 372.853 84.5337 372.067 84.9801 371.399C85.4265 370.731 86.061 370.21 86.8033 369.903C87.5457 369.596 88.3625 369.515 89.1505 369.672C89.9386 369.829 90.6625 370.215 91.2306 370.784C91.7988 371.352 92.1857 372.076 92.3424 372.864C92.4992 373.652 92.4187 374.469 92.1112 375.211C91.8038 375.953 91.2831 376.588 90.615 377.034C89.9469 377.48 89.1615 377.719 88.358 377.719H88.3509ZM92.2285 368.444C92.5454 368.045 92.8938 367.622 93.2675 367.19C93.8501 367.634 94.3704 368.155 94.8143 368.738C94.4034 369.093 93.9852 369.439 93.56 369.777C93.1828 369.27 92.7343 368.822 92.2285 368.444Z"
        fill="#5ED296"
      />
      <circle cx="19.5" cy="676.5" r="19" fill="#F3F3F3" stroke="#9CD1F9" />
      <path
        d="M11.25 686.167H19.7083V688.583H11.25C9.90873 688.583 8.83331 687.508 8.83331 686.167V666.833C8.83331 666.192 9.08793 665.578 9.54114 665.125C9.99435 664.671 10.609 664.417 11.25 664.417H25.75C26.3909 664.417 27.0056 664.671 27.4588 665.125C27.912 665.578 28.1666 666.192 28.1666 666.833V677.153L26.3541 676.162L25.75 676.5V666.833H19.7083V676.5L16.6875 673.781L13.6666 676.5V666.833H11.25V686.167ZM33 682.542L26.3541 678.917L19.7083 682.542L26.3541 686.167L33 682.542ZM22.125 685.067V687.484L26.3541 689.792L30.5833 687.484V685.067L26.3541 687.375L22.125 685.067Z"
        fill="#5ED296"
      />
    </svg>

    <div
      class="container flex flex-col gap-y-10 lg:gap-y-45 lg:flex-col items-end"
    >
      <div
        v-for="item in timelineText"
        :key="item.id"
        class="flex items-start lg:w-2/3 gap-x-4"
      >
        <NuxtImg
          :src="item.Image"
          width="150"
          height="150"
          class="object-contain rounded-2xl border-5 border-info-400 shadow-2xl"
        />
        <div class="flex flex-col gap-y-2">
          <h3 class="font-bold text-lg">
            {{ item.year }}
          </h3>
          <p class="text-sm dark:text-white">{{ item.text }}</p>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
  import { NuxtImg } from '#components'
  import { throttle } from 'lodash-es'

  const timelineText = [
    {
      id: 1,
      year: '1999',
      text: 'Я родилась в маленьком городке Южа Ивановской области. С самого детства меня тянуло к рисованию.',
      Image: 'timeline/1.png',
    },
    {
      id: 2,
      year: '2013',
      text: 'В 14 лет состоялась моя первая персональная выставка — это было в художественной школе в Юже. Очень волнительно!',
      Image: 'timeline/2.png',
    },
    {
      id: 3,
      year: '2014-2018',
      text: 'Я поступила в Палехское художественное училище. Училась на художника-мастера, осваивала лаковую миниатюру и иконопись. За эти годы случилось много важного: В 2017 году сделала выставку своих акварелей и набросков в училище — назвала её «Радость творчества». В том же году неожиданно выиграла гран-при на конкурсе в Суриковском институте в Москве. После окончания училища какое-то время работала в мастерской, писала лаковые миниатюры.',
      Image: 'timeline/3.png',
    },
    {
      id: 4,
      year: '2019',
      text: 'Решила круто изменить жизнь — переехала в Петербург! Стала ходить на вечерние курсы при Академии Художеств, брала мастер-классы у разных художников-акварелистов.',
      Image: 'timeline/4.png',
    },
    {
      id: 5,
      year: '2018-2024',
      text: 'Выставки стали частью моей жизни: Провела несколько персональных выставок — в Юже, Шуе и Петербурге. Участвовала в куче коллективных выставок по всей России — больше 25!',
      Image: 'timeline/5.png',
    },
    {
      id: 6,
      year: '2022-2024',
      text: 'Начала преподавать: Сначала просто мастер-классы по акварели. Потом стала вести занятия в онлайн-школах. Полюбила выезжать с учениками на пленэры по Петербургу. Из ярких событий: В 2024 году мои работы попали в Третьяковку — участвовала в выставке «Искусство труда». В том же году мои акварели отправились в Новосибирск на выставку «Вокруг света».',
      Image: 'timeline/6.png',
    },
    {
      id: 7,
      year: '2025',
      text: 'Этот год начался круто: Заняла первое место на фестивале акварели в Ижевске. Провела необычный эксперимент — арт-йога тур на Алтае. Набрала группу «нерисующих» студентов — учимся видеть мир через творчество. Кажется, самое интересное ещё впереди!',
      Image: 'timeline/7.png',
    },
  ]

  let scrollHandler = null
  let path = null

  const setupScrollAnimation = () => {
    path = document.querySelector('#scrollPath')
    if (!path) return

    const pathLength = path.getTotalLength()
    path.style.strokeDasharray = pathLength
    path.style.strokeDashoffset = pathLength

    path.style.willChange = 'stroke-dashoffset'

    scrollHandler = throttle(() => {
      // Вычисляем прогресс прокрутки (от 0 до 1)
      const scrollPercentage =
        (document.documentElement.scrollTop * 2 + document.body.scrollTop) /
        (document.documentElement.scrollHeight -
          document.documentElement.clientHeight)
      // Вычисляем длину для strokeDashoffset
      const drawLength = pathLength * scrollPercentage
      // Применяем изменения
      path.style.strokeDashoffset = -drawLength - 100
    }, 30)

    window.addEventListener('scroll', scrollHandler, { passive: true })
  }

  const cleanupScrollAnimation = () => {
    if (scrollHandler) {
      window.removeEventListener('scroll', scrollHandler)
      scrollHandler = null
    }
    if (path) {
      path.style.willChange = 'auto'
      path.style.strokeDasharray = ''
      path.style.strokeDashoffset = ''
      path = null
    }
  }

  onMounted(() => {
    setupScrollAnimation()
  })

  onBeforeUnmount(() => {
    cleanupScrollAnimation()
  })
</script>
